\documentclass[oneside,a4paper,10pts,article]{memoir}

\usepackage{palatino}
\usepackage{graphicx}
\usepackage{todonotes}
\presetkeys{todonotes}{inline}{}

\usepackage{url}
\usepackage[hidelinks,hyperindex]{hyperref}

\captionnamefont{\bfseries}

\usepackage{tikz}
\usetikzlibrary{positioning,arrows}



\title{Tradeable Certificates of Title on a blockchain \\
 {\normalfont\normalsize\scshape A case study on a trust-free vehicle registry}
}
\author{Martin Dybdal \texttt{dybber@dybber.dk}}
\date{\today}

\begin{document}

\maketitle

\begin{abstract}
  
\end{abstract}

\chapter{Preface}
This report was written as part of the ``Blockchain Summer School
2016'', which was held at the IT University of Copenhagen, August
2016. The summer school concluded with a 1-day hackathon, where we in
groups were assigned a case, that we should solve using blockchain
technology. Group-members: Felix Albert, Jacob Cholewa, Arun Prasad,
Benedikt Notheisen and Martin Dybdal.

\chapter{Introduction}
Blockchain technology is said to revolutionise businesses in domains
such as finance, logistics and administration, because contracts,
certificates and other legal or financial documents, can be fully
digitised. Blockchain technology provides a decentralised database
infrastructure which is tamper-proof and trust-free. In essence, a
blockchain is a distributed, append-only digital ledger, which can be
trusted, as consensus on transactions are reached across all nodes in
the network and is made tamper-proof by the use of hashing
algorithms. Blockchain systems are called trust-free, as you do not
need to trust any individual parties; the trust is generated by
contruction. The underlying principles and technology behind
blockchains is described in detail in Section \ref{sec:blockchain}.

In this project we have worked on a case arising in public sector
administration, from the Danish Tax Agency (SKAT). SKAT is responsible
for administering the registry of motorised vehicles in Denmark. The
Motor Registry is concerned with most aspects of a cars life cycle,
its initial registration on import, registration and ownership
taxation, insurance, police reports, MOT Tests, repairs and change of
ownership. The current system faces several problems related to lack
of documentation, imbalance of knowledge between parties and imbalance
of trust. It is SKATs hope that a blockchain solution might mitigate
some of these issues, which in turn might reduce the administrative
burden of operating such as system.

The aspect of ownership change is a core problem in the digitisation
of \textit{Vehicle Titles} (dan. registreringsattester), as there is
an imbalance of knowledge and trust between the buyer and seller. We
have developed a small prototype system, which can represent a Vehicle
Title as a tradeable contract on the blockchain system
Ethereum. Though not implemented, we expect that our prototype can be
extended to also address the issues regarding lack of documentation,
such as documentation of repairs and accidents.

The rest of the report is structured as follows. In Section
\ref{sec:blockchain} we will describe Blockchains from a technical
perspective. In Section \ref{sec:case} we will introduce the case from
SKAT, and detail the major steps in Vehicle registration and taxation
in Denmark. In Section \ref{sec:trading} we describe the core problems
of trading contracts between two parties, and how these problems can
be solved using a blockchain. In Section \ref{sec:currency} we look at
the problem of representing non-crypto currencies, such as Danish
Kroner or Euro's in a blockchain. In Section \ref{sec:implementation}
we describe our Ethereum prototype and in Section \ref{sec:futurework}
and \ref{sec:conclusion} we describe future prospects and conclude.

\chapter{Blockchain}
\label{sec:blockchain}
Blockchain technology originates from the technology behind the
Bitcoin crypto-currency \cite{bitcoin}, where it is used to avoid the
problem of double-spending in transaction systems. Previously,
double-spending was hindered by using a trusted third party, which
verified and timestamped all transactions.

A blockchain is a series of timestamped data blocks, where each block
in the series contains a hash of the previous block. These hashes
serves the purpose of linking the blocks into chain, such that no
block in the chain can be tampered with, without also updating all
blocks following it.

\begin{figure}[!h]
  \centering
\begin{tikzpicture}
    [remember picture, node distance=5mm and 5mm, ] \footnotesize
    \node[draw] (block1) at (0,0) {
      \begin{tikzpicture}
        \node[anchor=west] (b1title) {Block $n$}; \node[draw, below=of
        b1title.west, anchor=west] (b1prevhash)
        {$\textsf{Hash}(\textrm{Block}~n-1)$}; \node[draw, minimum
        width=3cm, below=of b1prevhash.west, anchor=west] (b1data)
        {Transactions};
      \end{tikzpicture}
    }; \node[draw, xshift=2cm] (block2) at (block1.east) {
      \begin{tikzpicture}
        \node[anchor=west] (b2title) {Block n+1}; \node[draw, below=of
        b2title.west, anchor=west] (b2prevhash)
        {$\textsf{Hash}(\textrm{Block}~n)$}; \node[draw, below=of
        b2prevhash.west, anchor=west, minimum width=3cm] (b2data)
        {Transactions};
      \end{tikzpicture}
    }; \node[draw, xshift=2cm] (block3) at (block2.east) {
      \begin{tikzpicture}
        \node[anchor=west] (b3title) {Block n+2}; \node[draw, below=of
        b3title.west, anchor=west] (b3prevhash)
        {$\textsf{Hash}(\textrm{Block}~n+1)$}; \node[draw, below=of
        b3prevhash.west, anchor=west, minimum width=3cm] (b3data)
        {Transactions};
      \end{tikzpicture}
    }; \node[xshift=-7mm] (block0) at (block1.west) { }; \draw[->]
    (block0.east) -- (b1prevhash); \draw[->] (block1.east) --
    (b2prevhash); \draw[->] (block2.east) -- (b3prevhash);
  \end{tikzpicture}
\end{figure}
To ensure that only one linear chain of blocks are allowed, and that
all parties agree on the same course of events, blockchains employ a
consensus mechanism. Such a consensus mechanism is essential to make
double-spending impossible without a third party. 

Essentially what is needed, is that a majority of the nodes in the
distributed network agrees on the same course of events. One might
attempt doing this by a majority vote, where each user has one
vote. This will however not work without a central system registering
the active users. In a open distributed system, nodes can join and
leave the system at any time, and we thus have no way of determining
the total number of voters, and we will never be able to determine
when a majority has been reached.  The vote has to decided by other
means than a simple count.

\section{Consensus by Proof-of-Work}
In the original Bitcoin system and in most current blockchain systems,
reaching consensus on a single history of transactions is done by
voting using CPU-power, where nodes have to solve a computationally
hard challenge, to add a new block of transactions to the chain. The
approach is called Proof-of-Work (PoW), and before Bitcoin it was suggested
as an approach to combat spam emails \cite{dwork1992pricing}.

To exemplify, consider the system employed by Bitcoin. An additional
field is added to the block and the nodes have to find a specific
value for this field, such that the entire block's hash has a certain
number of leading zero bits. The difficulty increases exponentially in
the number of zero bits, and difficulty can thus be adjusted over
time. The verification process is cheap however, as it only amounts to
do a hash over a single block.

When a node finds a solution for a block, he broadcasts the new block
to all other nodes, which verify his solution. To accept the solution,
they start working on a solution for the next block. If the enemy
wants to add fraudulent transactions to the chain, he will have to
control more than 50\% of the CPU-power in the network, otherwise the
majority will solve and verify other blocks before him.

\todo{longest chain}

\section{Consensus by Proof-of-Space}
A major problem with the Proof-of-work system, is the amount of energy
such a scheme will consume. Several alternative consensus mechanisms
has been suggested, to address the energy efficiency of the
Proof-of-Work scheme. One such scheme is \emph{Proof-of-Space}
\cite{dziembowski2015proofs}, where nodes instead will vote using disk
space. All nodes will store a data structure ... and the challenge
put up is no longer computational, but ...

\section{Consensus by Proof-of-Stake}
Another alternative is a scheme, where the voting power is distributed
relative to the amount of wealth of the nodes (and for how long they
have had the acquired wealth). This consensus scheme is called
Proof-of-Stake, and originates from the Bitcoin-alternative called
Peercoin or PPCoin \cite{king2012ppcoin}.

It has been suggested that Bitcoin moves to a Proof-of-Stake scheme,
the scheme has however been criticised for its inability to hinder
long-range attacks. In the Proof-of-Work scheme, it is virtually
impossible to suggest changes to more than one or two blocks behind
the current head, because of the enormous computing power
necessary. In Proof-of-Stake however, attackers can start at any point
in in the entire history of the blockchain, if they were wealthy
enough at that point in time \cite{buterin2014onstake}. In that sense,
Proof-of-Stake is not trustless, you especially have to trust that the
nodes participating in the genesis of the chain will not create a
different history of events.

Another criticism is that individual nodes have
\textit{nothing-at-stake}, in the sense that nodes have nothing to
lose from voting on many different blockchain histories. When the
incentive is lacking for working on only the longest chain, the vote
might never be resolved.

\section{Checkpointing}
To resolve the problems of history-rewriting in Proof-of-Stake,
checkpointing have suggested. No blockchain reorganization is allowed
deeper than the last known checkpoint. Even though the Proof-of-Work
scheme forced strong protection Bitcoin introduced checkpoints in 2010
\cite{king2012ppcoin}. Using checkpoints also has the positive impacts
that clients joining the network late, do only need to download the
part of the chain from the last checkpoint and forward, unless they
want to verify the entire history of events.

Checkpointing in both Peercoin and Bitcoin is implemented using a
centralized mechanism. In Bitcoin every release of Bitcoin software
contains a new checkpoint. In Peercoin checkpoints are signed using
the Peercoin developer's private key and broadcasted.

\section{Consistency, availability and partition tolerance}
As per the CAP Theorem, no system can be both consistent, available
and partition tolerant.

\begin{itemize}
\item ``Impossibility of Distributed Consensus with One Faulty Process''
\item Byzantine Generals' Problem
\item Partition tolerancy and CAP Theorem
\item Privacy and anonymity
\end{itemize}

\section{Ethereum}
\todo{Describe the Ethereum platform}
\cite{buterin2013ethereum, wood2014ethereum}

\todo{explain Ether currency}

%\newpage
\chapter{Case description}
\label{sec:case}
We will now describe the case presented by SKAT on the Danish Motor
Registry. Registration of vehicles, collecting vehicle taxes, and
interacting with other stakeholders, such as police, insurance
companies and transport authorities, requires a lot of administration,
and a lot of things can go wrong in process.

\section{The life cycle of a vehicle}
During the life cycle of vehicle, it goes through various owners and
activities, and involves several different parties, such as car
importers, police, insurance companies, MOT testing centers and
transport authorities. When a car is imported into the country, it is
registered as owned by the importer, which sells it to a specific
dealer. The dealer then sells it to a private owner or a corporation,
and the car can be re-sold multiple times. See Figure \ref{fig:lifecycle}.

A crucial aspect is the change of ownership through the supply chain
and between private persons. Especially the current process of private
car trade is problematic, as there is an imbalance of knowledge and
trust between the seller and the buyer. The buyer might not know the
full history of owners, accidents or repairs, and as the Vehicle Title
is currently on paper, it might be forged or the car might be
stolen. On the other hand, the seller has to put trust in the buyer,
that he will in fact re-register the car in his own name. Currently,
if the buyer does not immediately re-register the car, the sellers
insurance might still be covering damages and the buyer could use the
criminal activities, without being recorded as the owner of the car.

This means that activities such as MOT test, repairs and accident
reports are crucial for the buyer, and for the seller the
re-registration should be a part of the shift of ownership.

\begin{figure} %[b]
  \centering
  \includegraphics[width=\textwidth]{lifecycle.png}
  \caption{Vehicle life cycle}
  \label{fig:lifecycle}
\end{figure}

\section{Vehicle taxation in Denmark}
Taxation-wise there are several places where the Tax Agency needs to
be involved. When a car is imported, it has to be registered and a
registration tax has to be paid, it does not matter whether the car is
new or used. A yearly ownership tax is also collected for car owners,
and the Tax Agency thus also needs to know when a car is sold. Also,
several fees can be levied as part of the process, for example a
re-registration fee. It is also the Tax Agency's job to make sure that
all registered cars are insured by their owner.

\section{Core challenges}
As outlined in the description above, the core challenges are:

\begin{itemize}
\item Giving buyer knowledge of vehicle history, which he can trust
\item Giving seller trust, that the buyer will not commit fraud, and
  use the vehicle in the sellers name.
\item Ensuring that ownership taxes are collected from the rightful
  owner of the vehicle
\end{itemize}


\chapter{Trading contracts}
\label{sec:trading}
Now let us look at how blockchain systems can help mitigate the issues
of the Danish Motor Registry. As described in Section \ref{sec:case},
the main underlying challenge is the transfer of ownership between a
seller and a buyer. This ownership is represented by a contract, a so
called \emph{Certificate of Title} or in the case of a vehicles, a
\emph{Vehicle Title}. Trading a vehicle, thus really means trading the
Vehicle Title, stating who is the rightful owner. In this section we
will describe the current process of such a trade, and we will
describe how a blockchain solution, can mitigate most of the current
problems.

\section{Trading vehicles today}
The current process of trading a car between two persons
(private-to-private), is as follows:

\begin{enumerate}
\item Buyer inspects the condition of the car
\item Seller and buyer agrees on a price
\item Seller hands the registration certificate to the buyer. Buyer
  transfers the agreed amount of money to the sellers bank account.
\item When the money is received, the seller hands the car keys to buyer.
\item The buyer goes to \url{http://motorregister.skat.dk} and
  re-registers the car in his name.
\end{enumerate}
This process is risky for on both the seller and the buyer.
\begin{itemize}
\item The seller must trust that the buyer performs Step 5. The seller
  risks that levies will continue to be collected from him, not the
  new owner. The seller also risks that the buyer uses the car illegal
  activities or is involved in accident while the car is still insured
  by the seller.
\item In Step 3, The buyer has no way to verify that the registration
  certificate is correct. There is a risk that there is hidden debt in
  the car, that the car is stolen or that the car has been through
  major repairs.
\end{itemize}

\section{Trading on the blockchain}
We will now describe how a blockchain solution might solve these trust
issues between the seller and the buyer. When a blockchain is used,
the Vehicle Title might be stored as an \emph{updateable} contract
\emph{on} the blockchain. By doing this the blockchain network agrees
on this contract as valid and we can trust its content. We can limit
whom may issue new Vehicle Titles to for example SKAT or MOT test
centers. 

In addition to carrying information identifying the actual car, the
contract may also be updated with police reports, MOT test outcomes,
insurance information and so on, which the buyer might be interested
in.

When a contract changes hands, it changes hands immediately, and SKAT
as well as insurance companies are notified immediately. By making the
money transfer and the change of ownership in the contract part of the
same transaction, we also protect the seller from the risks described
above. The fact that a new owner is recorded in the contract, is what
counts as re-registration. No additional re-registration is
necessary.

We have illustrated the transaction process of trading a vehicle using
the blockchain in Figure \ref{fig:shift-of-ownership}.

\begin{figure}
  \centering
  \includegraphics[width=\textwidth]{shift-of-ownership.pdf}
  \caption{Transaction process for shift of ownership.}
  \label{fig:shift-of-ownership}
\end{figure}

The problems described here are not only found in trades involving
cars. The same type of risks arise when selling or buying a house. In
fact, this blockchain scheme can be generalised, and we can build a
general framework for trading \textit{any} contract that can be
represented on the blockchain. We present such a framework implemented
in Ethereum in Section \ref{sec:implementation}.

\chapter{Representing non-crypto currencies}
\label{sec:currency}
An orthogonal issue, to the issue of trading contracts, is the
question of how non-crypto currencies, like Euro or Danish Kroner
(DKK) should be represented on a blockchain. We want to support trades
which are not settled in Bitcoin or Ether, but on our current
financial markets. One approach is to go through an exchange and
exchange Euro or DKK for Ether whenever a sale is performed, this
however incurs overhead of exchange rates and potential fees.

Another possibility is to represent these currencies as
\textit{tokens} on the blockchain. \todo{explain token}

To do this, we have to assume that a trusted third-party will allow
conversion back and forth between Danish Kroner and block-chain
tokens. This third-party could be the Danish Central Bank or a major
privately owned bank. Currently most transactions are already only
represented digitally, and such a conversion will thus be a matter of
conversion from the current database-representation to a blockchain
\emph{token}-representation. In the rest of the paper we assume that
such a trusted third-party exists, and we use tokens as currency when
trading contracts.

\chapter{Implementation}
\label{sec:implementation}


\section{Experience using Ethereum}
\todo{Describe how horrible the development environment is, how bad the
documentation is, and how terrible the error messages are.}

\todo{Mention that Ethereum currently is good for prototyping, nothing else. }

\todo{Eventually a better language than Solidity may be introduced, but
currently not a good platform for any serious projects.}

\todo{Mention Certified contract languages, such as the work by Tom
  Hvitved or Patrick Bahr.}

\chapter{User experience design}
\todo{Contracts should be tied to NemID or Corporate ID.}

\todo{Describe the entire process suggested in Mockup-app from SKAT.}

\todo{IoT}

\todo{users should trust blockchain technology, as the actual
  contracts are now on the blockchain}

\chapter{Future work}
\label{sec:futurework}

\begin{itemize}
\item Proof of work, proof of stake, proof of space?
\item Can a system built now, be migrated to another system?
\item How much should be stored off the blockchain?
\item Prospect of using a more formaly defined contract specification language
\end{itemize}

\chapter{Conclusion}
\label{sec:conclusion}

\todo{\cite{beck2016blockchain}}



\bibliographystyle{plainurl}
\bibliography{bibliography}



\end{document}